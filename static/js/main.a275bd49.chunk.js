(this.webpackJsonpmuesli=this.webpackJsonpmuesli||[]).push([[0],{100:function(e,n,t){},105:function(e,n,t){"use strict";t.r(n);var a=t(0),r=t.n(a),c=t(29),i=t.n(c),o=(t(100),t(75)),l=t(155),u=t(148),s=(t(65),t(14)),d=t(13),b=t(156),j=t(154),g=t(147),h=t(150),f=t(157),p=t(149),m=t(158),O=t(160),v=t(161),x=t(152),V=t(42),y=t(47),C=t(153),S=t(2),w=["enabled","enableText","disableText"];var P=function(e){e.enabled,e.enableText,e.disableText;var n=Object(y.a)(e,w);return Object(S.jsx)(C.a,Object(V.a)(Object(V.a)({color:e.enabled?"error":"success"},n),{},{children:e.enabled?e.disableText||"Disable":e.enableText||"Enable"}))},k=t(72),A=t.n(k),R=t(22);var T,U=function(e){var n,t=Object(R.a)(),r=Object(a.useRef)(),c=Object(a.useRef)();function i(){var e;null===(e=c.current)||void 0===e||e.play()}return Object(a.useEffect)((function(){return c.current=A.a.create({container:r.current,responsive:!0}),function(){c.current.destroy(),c.current=null}}),[]),Object(a.useEffect)((function(){var e,n;null===(e=c.current)||void 0===e||e.setWaveColor(t.palette.primary.dark),null===(n=c.current)||void 0===n||n.setProgressColor(t.palette.secondary.dark)}),[t.palette.primary.dark,t.palette.secondary.dark]),Object(a.useEffect)((function(){var n,t;e.autoplay?null===(n=c.current)||void 0===n||n.on("ready",i):null===(t=c.current)||void 0===t||t.un("ready")}),[e.autoplay]),Object(a.useEffect)((function(){var n,t;e.audioPath?null===(n=c.current)||void 0===n||n.load(e.audioPath):null===(t=c.current)||void 0===t||t.empty()}),[e.audioPath]),Object(a.useEffect)((function(){var n,t;e.loop?null===(n=c.current)||void 0===n||n.on("finish",i):null===(t=c.current)||void 0===t||t.un("finish")}),[e.loop]),Object(S.jsxs)(b.a,{children:[Object(S.jsxs)("h2",{children:["AudioDisplay WIP: ",e.name||"No Name"]}),Object(S.jsxs)("p",{children:["Audio Path: ",e.audioPath]}),Object(S.jsxs)("p",{children:["Audio Duration: ",1e3*(null===(n=c.current)||void 0===n?void 0:n.getDuration()),"ms"]}),Object(S.jsx)("div",{ref:r}),Object(S.jsx)(C.a,{onClick:i,children:"Play Audio"}),Object(S.jsx)(C.a,{onClick:function(){var e;null===(e=c.current)||void 0===e||e.pause()},children:"Pause Audio"})]})},D=t(76),M=t(73),E=t.n(M);function F(e,n,t){t||(t=e.reduce((function(e,n){return e+n.length}),0));var a=function(e,n){var t=new ArrayBuffer(44+2*e.length),a=new DataView(t);return I(a,0,"RIFF"),a.setUint32(4,32+2*e.length,!0),I(a,8,"WAVE"),I(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,1,!0),a.setUint32(24,n,!0),a.setUint32(28,2*n,!0),a.setUint16(32,2,!0),a.setUint16(34,16,!0),I(a,36,"data"),a.setUint32(40,2*e.length,!0),function(e,n,t){for(var a=0;a<t.length;a++,n+=2){var r=Math.max(-1,Math.min(1,t[a]));e.setInt16(n,r<0?32768*r:32767*r,!0)}}(a,44,e),a}(function(e,n){for(var t=new Float32Array(n),a=0,r=0;r<e.length;r++)t.set(e[r],a),a+=e[r].length;return t}(e,t),n);return new Blob([a],{type:"audio/wav"})}function I(e,n,t){for(var a=0;a<t.length;a++)e.setUint8(n+a,t.charCodeAt(a))}!function(e){e.OpeningPadding="OpeningPadding",e.Waiting="Waiting",e.Recording="Recording"}(T||(T={}));var W=function(e,n,t,a,r){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-60,i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:500;if(a<=i)throw new Error("Silence detection period must be greater than padding period");var o=2048,l=new AudioContext,u=l.createMediaStreamSource(e),s=new AnalyserNode(l,{minDecibels:c}),d=l.createScriptProcessor(o,2,0);u.connect(s).connect(d),console.log("Source Sample Rate: ",l.sampleRate);var b=l.sampleRate/1e3,j=o/b;console.log("Chunk Size Ms: ",j);var g=i/j,h=new Uint8Array(s.frequencyBinCount),f=[],p=T.OpeningPadding,m=null;function O(){var e=performance.now();if(s.getByteFrequencyData(h),p!==T.OpeningPadding)if(h.some((function(e){return e}))&&(m=e,p===T.Waiting&&console.log("Detected Audio"),p=T.Recording),null===m)n(0);else{var t=e-m;n(Math.max(0,a-t)),p===T.Recording&&t>a&&(console.log("Detected Silence"),v(t-i),x(),p=T.Waiting)}else console.log("Skipping silence detection while waiting for padding")}function v(e){var n=e/j;console.log("Converting Audio:",f.length,"chunks available, trmming",n);var a=F(f.slice(0,f.length-n),l.sampleRate),r={name:E()({exactly:1,wordsPerString:2,separator:"-"})[0],url:window.URL.createObjectURL(a)};console.log("Generated clip",r),t(r)}function x(){f=f.slice(f.length-g,f.length)}function V(e){f.push(e),f.length>g&&(p!==T.OpeningPadding&&p!==T.Waiting||(f.shift(),p=T.Waiting))}function y(){console.log("Recorder has been stopped; publishing final clip...");var n=(r+i)/j;if(null===m)console.log("Skipping final clip publish as silence has never been detected");else if(f.length<=n)console.log("Skipping final clip publish as number of chunks",f.length,"<=",n);else{v(performance.now()-m-i)}l.close(),e.getTracks().forEach((function(e){return e.stop()}))}d.onaudioprocess=function(e){V(e.inputBuffer.getChannelData(0))},console.log("Starting Recorder...");var C=setInterval(O,100);return function(){clearInterval(C),y(),console.log("Ran cleanup function for recording routine")}},B=["minValue","maxValue","onChange"];var N=function(e){var n=Object(a.useState)(!1),t=Object(d.a)(n,2),r=t[0],c=t[1];e.minValue,e.maxValue,e.onChange;var i=Object(y.a)(e,B);return Object(S.jsx)(p.a,Object(V.a)({error:r,onChange:function(n){return function(n){var t=Number(n.target.value);!n.target.value.trim()||isNaN(t)||e.minValue&&t<e.minValue||e.maxValue&&t>e.maxValue?c(!0):(c(!1),e.onChange&&e.onChange(t))}(n)},helperText:r?e.minValue&&e.maxValue?"Value must be a number between ".concat(e.minValue," and ").concat(e.maxValue):e.minValue?"Value must be a number at least ".concat(e.minValue):e.maxValue?"Value must be a number at most ".concat(e.maxValue):"Value must be a number":void 0},i))};var L=function(e){var n=Object(a.useRef)(),t=Object(a.useState)(),r=Object(d.a)(t,2),c=r[0],i=r[1],o=Object(a.useState)(),l=Object(d.a)(o,2),u=l[0],V=l[1],y=Object(a.useState)(1e3),C=Object(d.a)(y,2),w=C[0],k=C[1],A=Object(a.useState)(3e3),R=Object(d.a)(A,2),T=R[0],M=R[1];Object(D.a)("r",(function(e){e.altKey&&L()}));var E=Object(a.useState)([]),F=Object(d.a)(E,2),I=F[0],B=F[1];function L(){c?(n.current(),n.current=null,i(!1),V(0)):(navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){n.current=W(e,V,q,T,w)})),i(!0))}function q(e){B((function(n){return[e].concat(Object(s.a)(n))}))}var J=Object(a.useState)(!1),z=Object(d.a)(J,2),G=z[0],H=z[1],K=Object(a.useState)(!1),Q=Object(d.a)(K,2),X=Q[0],Y=Q[1];return Object(S.jsxs)(b.a,{className:"App",children:[Object(S.jsx)("h2",{children:"Muesli Practice Helper"}),Object(S.jsxs)(j.a,{container:!0,spacing:2,children:[Object(S.jsx)(j.a,{item:!0,id:"controls",xs:5,sm:4,md:3,lg:2,children:Object(S.jsxs)(g.a,{spacing:2,children:[Object(S.jsx)(h.a,{title:"Toggle with Alt-R",arrow:!0,children:Object(S.jsx)(P,{enabled:c,enableText:"Start Recording",disableText:"Stop Recording",onClick:L})}),Object(S.jsxs)("p",{children:["Mic Open: ",String(c)]}),Object(S.jsxs)("p",{children:["Time until Clip: ",String(Math.floor(u/100)/10)," seconds"]}),Object(S.jsx)(f.a,{variant:"determinate",value:u/T*100}),Object(S.jsx)(p.a,{label:"Custom Audio File Path",placeholder:"(debug only)",onChange:function(e){return B([{url:e.target.value}])}}),Object(S.jsx)(N,{disabled:c,label:"Cut clip when silent for",placeholder:"Time...",InputProps:{endAdornment:Object(S.jsx)(m.a,{position:"end",children:"s"})},defaultValue:T/1e3,minValue:1,maxValue:15,onChange:function(e){return M(1e3*e)}}),Object(S.jsx)(N,{disabled:c,label:"Discard clips shorter than",placeholder:"Time...",InputProps:{endAdornment:Object(S.jsx)(m.a,{position:"end",children:"s"})},defaultValue:w/1e3,minValue:0,maxValue:5,onChange:function(e){return k(1e3*e)}}),Object(S.jsxs)(O.a,{children:[Object(S.jsx)(v.a,{control:Object(S.jsx)(x.a,{onChange:function(e){return H(e.target.checked)}}),label:"Loop"}),Object(S.jsx)(v.a,{control:Object(S.jsx)(x.a,{onChange:function(e){return Y(e.target.checked)}}),label:"Autoplay"})]})]})}),Object(S.jsx)(j.a,{item:!0,id:"clips",xs:7,sm:8,md:9,lg:10,children:Object(S.jsx)(g.a,{spacing:2,children:I.map((function(e){return Object(S.jsx)(U,{name:e.name,audioPath:e.url,autoplay:X,loop:G},e.url)}))})})]})]})};var q=function(){var e=Object(o.a)({palette:{mode:"dark",background:{default:"#10051a"}},components:{MuiButton:{defaultProps:{variant:"outlined"}}}});return Object(S.jsxs)(l.a,{theme:e,children:[Object(S.jsx)(u.a,{}),Object(S.jsx)(L,{})]})},J=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,162)).then((function(n){var t=n.getCLS,a=n.getFID,r=n.getFCP,c=n.getLCP,i=n.getTTFB;t(e),a(e),r(e),c(e),i(e)}))};i.a.render(Object(S.jsx)(r.a.StrictMode,{children:Object(S.jsx)(q,{})}),document.getElementById("root")),J()},65:function(e,n,t){}},[[105,1,2]]]);
//# sourceMappingURL=main.a275bd49.chunk.js.map